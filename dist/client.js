(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var r in t)e.o(t,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:t[r]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=require("crypto");var t=e.n(n);const r=require("net");var o=e.n(r);const c=require("fs");var a=e.n(c);function i(e,n,t,r){var o=Buffer.alloc(9);o.writeUInt8(n,0),o.writeUInt32BE(t||0,1),o.writeUInt32BE((null==r?void 0:r.length)||0,5),e.write(Buffer.concat([o,r||Buffer.alloc(0)]))}function u(e,n){i(e,2,n)}var l=function(e,n){var t,r,o,c,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return c={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(u){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},s=process.argv[2].split(":"),f=s[0],d=s[1],v=d?parseInt(d):80,h=function(){try{if(32!==(e=a().readFileSync("client-id")).length)throw new Error("Invalid client-id file");return e}catch(n){var e=t().randomBytes(32);return a().writeFileSync("client-id",e),e}}(),p={};function y(e,n){var t;return{refresh:function(){clearTimeout(t),t=setTimeout(n,e)},clear:function(){return clearTimeout(t)}}}function b(e,n){var t=o().createConnection(v,f),r=y(3e5,(function(){console.log("Client socket timeout"),t.destroy(),delete p[e]})),c=r.refresh,a=r.clear;t.on("data",(function(t){!function(e,n,t){i(e,1,n,t)}(n,e,t),c()})),t.on("close",(function(){u(n,e),a(),delete p[e]})),t.on("error",(function(t){u(n,e),a(),delete p[e]})),p[e]=t}!function(){var e,n,t,r;e=this,n=void 0,r=function(){var e;return l(this,(function(n){switch(n.label){case 0:e=function(){var e,n,t,r,c,a,u,s;return l(this,(function(l){switch(l.label){case 0:console.log("Connecting to server"),function(e,n){i(e,8,0,n)}(e=o().createConnection(81,"tunnel.unknownpgr.com"),h),n=y(3e4,(function(){e.destroy()})),t=n.refresh,r=n.clear,setInterval((function(){t(),i(e,16)}),3e4),f=Buffer.alloc(0),c=function(e){f=Buffer.concat([f,e]);for(var n=[];f.length>=9;){var t=f.readUInt8(0),r=f.readUInt32BE(1),o=f.readUInt32BE(5);if(f.length<9+o)break;var c=f.subarray(9,9+o);f=f.subarray(9+o),n.push({type:t,id:r,data:c})}return n},e.on("data",(function(n){for(var t=0,o=c(n);t<o.length;t++){var a=o[t],i=a.type,u=a.id,l=a.data;1&i&&(p[u]||b(u,e),p[u].write(l)),2&i&&p[u]&&(p[u].end(),delete p[u]),4&i&&console.log(l.toString()),r()}})),a=new Promise((function(n,t){e.on("close",n),e.on("error",t)})),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,a];case 2:return l.sent(),[3,4];case 3:return u=l.sent(),console.error(u),[3,4];case 4:for(s in console.log("Disconnected from server"),r(),p)p[s].destroy(),delete p[s];return console.log("Waiting for 5 seconds"),[4,new Promise((function(e){return setTimeout(e,5e3)}))];case 5:return l.sent(),[2]}var f}))},n.label=1;case 1:return[5,e()];case 2:return n.sent(),[3,1];case 3:return[2]}}))},new((t=void 0)||(t=Promise))((function(o,c){function a(e){try{u(r.next(e))}catch(e){c(e)}}function i(e){try{u(r.throw(e))}catch(e){c(e)}}function u(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,i)}u((r=r.apply(e,n||[])).next())}))}()})();