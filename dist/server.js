(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var r in t)e.o(t,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:t[r]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=require("net");var t=e.n(n);const r=require("crypto");var o,a=e.n(r);function l(e,n,t,r){var o=Buffer.alloc(9);o.writeUInt8(n,0),o.writeUInt32BE(t||0,1),o.writeUInt32BE((null==r?void 0:r.length)||0,5),e.write(Buffer.concat([o,r||Buffer.alloc(0)]))}function c(e,n){l(e,4,0,n)}(o={})[1]="data",o[2]="close",o[4]="log";function i(e){return a().createHash("sha256").update(e).update("CIadLOjDL7QguYCPwbKlVHkvc58FzwcgYT3uc2pgDG1wAoQzuhjEj4FCjQ").digest("hex").slice(0,16)}var u=0,s={},f={},d=t().createServer((function(e){var n=null;function t(){for(var e in console.log("Worker disconnected: "+n),delete s[n],f[n])f[n][e].destroy()}console.log("Worker connected"),e.on("close",t),e.on("error",t);var r,o=(r=Buffer.alloc(0),function(e){r=Buffer.concat([r,e]);for(var n=[];r.length>=9;){var t=r.readUInt8(0),o=r.readUInt32BE(1),a=r.readUInt32BE(5);if(r.length<9+a)break;var l=r.subarray(9,9+a);r=r.subarray(9+a),n.push({type:t,id:o,data:l})}return n});e.on("data",(function(t){for(var r=0,a=o(t);r<a.length;r++){var l=a[r],u=l.type,d=l.id,v=l.data;8===u?(n=i(v),console.log("Worker registered: "+n),s[n]=e,f[n]={},c(e,Buffer.from("https://".concat(n,".tunnel.unknownpgr.com")))):1===u?f[n]&&f[n][d]&&f[n][d].write(v):2===u?f[n]&&f[n][d]&&f[n][d].end():4===u?console.log(v.toString()):console.log("Unknown type: "+u)}}))})),v=t().createServer((function(e){return n=void 0,t=void 0,o=function(){var n,t;return function(e,n){var t,r,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(i){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(l=0)),l;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return l.label++,{value:c[1],done:!1};case 5:l.label++,r=c[1],c=[0];continue;case 7:c=l.ops.pop(),l.trys.pop();continue;default:if(!((o=(o=l.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){l=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){l.label=c[1];break}if(6===c[0]&&l.label<o[1]){l.label=o[1],o=c;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(c);break}o[2]&&l.ops.pop(),l.trys.pop();continue}c=n.call(e,l)}catch(e){c=[6,e],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,i])}}}(this,(function(r){return n=null,t=u++,e.on("data",(function(r){if(!n){if(n=function(e){var n=e.toString().split("\n").map((function(e){return e.trim()})).slice(1).reduce((function(e,n){var t=n.split(": "),r=t[0],o=t[1];return e[r]=o,e}),{});return n.Host&&n.Host.includes(".")?n.Host.split(".")[0]:null}(r),!n||!s[n])return console.log("Bad Request"),e.write("HTTP/1.1 400 Bad Request\r\n\r\n"),void e.end();f[n][t]=e;var o=function(){n&&(s[n]&&l(s[n],2,t),delete f[n][t])};e.on("close",o),e.on("error",o)}!function(e,n,t){l(e,1,n,t)}(s[n],t,r)})),[2]}))},new((r=void 0)||(r=Promise))((function(e,a){function l(e){try{i(o.next(e))}catch(e){a(e)}}function c(e){try{i(o.throw(e))}catch(e){a(e)}}function i(n){var t;n.done?e(n.value):(t=n.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,c)}i((o=o.apply(n,t||[])).next())}));var n,t,r,o}));d.listen(81,(function(){console.log("Client server listening on port 81")})),v.listen(80,(function(){console.log("User server listening on port 80")}))})();