const a=require("net");function t(e,n,o,t){let r;(r=t?Buffer.alloc(9+t.length):Buffer.alloc(9)).writeUInt8(n,0),r.writeUInt32BE(o,1),t?(r.writeUInt32BE(t.length,5),t.copy(r,9)):r.writeUInt32BE(0,5),e.write(r)}function i(e,n,o){t(e,0,n,o)}function e(e,n,o){t(e,3,n,o)}function l(e,n){t(e,1,n,Buffer.alloc(0))}function n(){let c=Buffer.alloc(0);return e=>{c=Buffer.concat([c,e]);for(var n=[];9<=c.length;){var o=c.readUInt8(0),t=c.readUInt32BE(1),r=c.readUInt32BE(5);if(c.length<9+r)break;const e=c.subarray(9,9+r);c=c.subarray(9+r),n.push({type:o,id:t,data:e})}return n}}const o="tunnel.unknownpgr.com",r=81,c=process.argv[2],[s,f]=c.split(":"),u=f?parseInt(f):80,d=n(),g={};async function w(){for(;;){console.log("Connecting to server");const c=a.createConnection(r,o);c.on("data",e=>{for(const r of d(e)){var{type:n,id:o,data:t}=r;0===n&&(g[o]||!function(n){var e=a.createConnection(u,s,()=>{console.log("Connected to application")});e.on("data",e=>{i(c,n,e)}),e.on("close",()=>{l(c,n),delete g[n]}),g[n]=e}(o),g[o].write(t)),1===n&&g[o]&&(g[o].end(),delete g[o]),3===n&&console.log(t.toString())}});var e=new Promise((e,n)=>{c.on("close",e),c.on("error",n)});try{await e}catch(e){console.error(e)}console.log("Disconnected from server");for(const n in g)g[n].destroy(),delete g[n];console.log("Waiting for 5 seconds"),await new Promise(e=>setTimeout(e,5e3))}}w();